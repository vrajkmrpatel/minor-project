@startuml
start

:Identify Customer;
if (Is customer registered?) then (yes)
    :Retrieve customer info;
else (no)
    :Register new customer;
endif

if (Customer identification valid?) then (yes)
    :Request Catalog?;
    if (Request Catalog?) then (yes)
        :Send Catalog;
    endif
    while (More products to select?) is (yes)
        :Select Product;
        :Get Product Information;
        if (Product available?) then (yes)
            :Check Inventory;
            if (Sufficient stock?) then (yes)
                :Add to Cart;
            else (no)
                :Product Out Of Stock;
                if (Customer wants alternative or backorder?) then (yes)
                    :Offer alternative or backorder option;
                    if (Customer accepts backorder?) then (yes)
                        :Add to backorder;
                        :Sign up for email notification?;
                        if (Customer wants email notification?) then (yes)
                            :Add customer to notification list;
                        endif
                    else (no)
                        :Offer alternative product;
                        if (Customer accepts alternative?) then (yes)
                            :Add alternative to cart;
                        else (no)
                            :Product selection continues;
                        endif
                    endif
                endif
            endif
        else (no)
            :Product Unavailable;
        endif
    endwhile
    :Provide Shipping Address;
    :Provide Billing Address;
    :Provide Credit Card Number;
    if (Credit card valid?) then (yes)
        :Submit Order;
        fork
            :Process Payment;
        fork again
            :Forward Order to Shipping;
        end fork
        :Earn Bonus Points;
        if (Total spent > Gold Customer threshold?) then (yes)
            :Promote to Gold Customer;
        endif
    else (no)
        :Invalid Payment;
        if (Retry payment?) then (yes)
            :Retry Payment;
            if (Credit card valid?) then (yes)
                :Submit Order;
                fork
                    :Process Payment;
                fork again
                    :Forward Order to Shipping;
                end fork
                :Earn Bonus Points;
                if (Total spent > Gold Customer threshold?) then (yes)
                    :Promote to Gold Customer;
                endif
            else (no)
                :Cancel Order;
            endif
        else (no)
            :Cancel Order;
        endif
    endif
else (no)
    :Invalid Customer;
endif

:Check Order Status;
if (Order cancelled?) then (yes)
    :Order Cancelled;
else (no)
    if (Return requested?) then (yes)
        if (Phone order?) then (yes)
            :Return Product (Phone);
        else (no)
            if (Is Gold Customer?) then (yes)
                :Return Product (Extended period);
            else (no)
                :Return Product (Standard period);
            endif
        endif
    endif
endif

stop
@enduml